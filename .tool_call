{"type":"tool_call","tool":"code.request","args":{"task":"Give Kingston full autonomous control over scheduling & automation.\n\nGOAL: Kingston should self-manage cron jobs, alarms, workflows without manual approval.\n\nCURRENT STATE:\n- cron.add() exists but requires manual setup\n- No self-service automation creation\n- Kingston can't adapt schedule based on learnings\n\nDESIRED STATE:\n\n## 1. SELF-SERVICE CRON MANAGEMENT\n\nAdd new skill methods:\n\n```typescript\n// Auto-create cron from natural language\ncron.smart_add({\n  description: \"Check Moltbook engagement every 2 hours during day\",\n  timezone: \"America/Toronto\",\n  auto_enable: true\n})\n// ‚Üí Parses intent, creates cron: \"0 8-20/2 * * *\"\n// ‚Üí Auto-generates prompt from description\n// ‚Üí Returns cron ID for reference\n\n// Adaptive scheduling\ncron.adaptive({\n  goal: \"maximize Moltbook engagement\",\n  current_schedule: \"0 14 * * *\", // Daily 2pm post\n  metric: \"upvotes_per_post\",\n  adjustment_strategy: \"hill_climbing\"\n})\n// ‚Üí Tests posting at different times\n// ‚Üí Tracks which times get most engagement\n// ‚Üí Auto-adjusts schedule to optimal time\n\n// Conditional execution\ncron.when({\n  condition: \"trading.account().equity > 105000\",\n  then: \"telegram.send('Portfolio hit $105K milestone!')\",\n  else: \"notes.add('Still working toward $105K')\"\n})\n```\n\n## 2. SMART ALARMS SYSTEM\n\nCreate new namespace: `alarms`\n\n```typescript\nalarms.set({\n  name: \"market_open\",\n  time: \"09:30\",\n  timezone: \"America/New_York\",\n  days: [\"mon\", \"tue\", \"wed\", \"thu\", \"fri\"],\n  action: \"trading.morning()\",\n  snooze_enabled: false\n})\n\nalarms.contextual({\n  trigger: \"portfolio_drawdown_5_percent\",\n  condition: \"trading.pnl().today < -5%\",\n  action: \"telegram.send('‚ö†Ô∏è Portfolio down 5% - review positions')\",\n  cooldown_minutes: 60 // Don't spam if continues dropping\n})\n\nalarms.recurring({\n  pattern: \"every_friday_5pm\",\n  action: \"trading.journal().weekly_summary()\",\n  auto_disable_on: \"vacation_mode\"\n})\n```\n\n## 3. WORKFLOW TEMPLATES\n\nPre-built workflows Kingston can activate:\n\n```typescript\nworkflow.activate(\"trading_daily\", {\n  steps: [\n    { time: \"07:00\", action: \"data.fetch_news()\" },\n    { time: \"07:30\", action: \"trading.morning()\" },\n    { time: \"09:25\", action: \"trading.prepare_orders()\" },\n    { time: \"16:00\", action: \"trading.journal()\" },\n    { time: \"17:00\", action: \"xp.audit()\" }\n  ]\n})\n\nworkflow.activate(\"moltbook_growth\", {\n  steps: [\n    { time: \"10:00\", action: \"moltbook.check_engagement()\" },\n    { time: \"14:00\", action: \"moltbook.post()\" },\n    { time: \"20:00\", action: \"moltbook.respond_to_comments()\" }\n  ]\n})\n```\n\n## 4. AUTO-LEARNING SCHEDULER\n\nKingston learns optimal schedules from outcomes:\n\n```typescript\nscheduler.learn({\n  task: \"moltbook.post\",\n  optimize_for: \"engagement\",\n  experiments: [\n    { time: \"10:00\", trials: 5 },\n    { time: \"14:00\", trials: 5 },\n    { time: \"18:00\", trials: 5 }\n  ],\n  auto_adopt_winner: true,\n  confidence_threshold: 0.8\n})\n// ‚Üí Tests each time 5 times\n// ‚Üí Measures engagement (upvotes + comments)\n// ‚Üí If 14:00 wins with 80%+ confidence, auto-switch to that\n```\n\n## 5. PERMISSION SYSTEM\n\nKingston can self-approve LOW-RISK automations:\n\n```yaml\nauto_approve_if:\n  - read_only: true  # Can auto-schedule data fetching\n  - internal_tool: true  # Can auto-schedule notes.add, xp.earn\n  - frequency: <= 1/hour  # Max once per hour\n  - cost: $0  # No paid API calls\n\nrequire_approval_if:\n  - writes_to: [telegram, email, social_media]\n  - frequency: > 1/hour\n  - cost: > $0\n  - affects: real_money\n```\n\n## 6. DASHBOARD VIEW\n\nAdd to web dashboard (port 3200):\n\n- Timeline view: All scheduled tasks visualized\n- Performance metrics: Success rate, avg duration, errors\n- Quick actions: Pause/Resume/Delete any cron\n- Experiment results: A/B test outcomes, optimal times\n\n## IMPLEMENTATION\n\nFILES:\n- src/skills/builtin/cron.ts (enhance existing)\n- src/skills/builtin/alarms.ts (new)\n- src/scheduler/adaptive.ts (new - learning scheduler)\n- src/scheduler/templates.ts (workflow presets)\n- src/dashboard/views/schedule.html (visualization)\n\nDB TABLES:\n```sql\nCREATE TABLE alarm_configs (\n  id INTEGER PRIMARY KEY,\n  name TEXT,\n  trigger_type TEXT, -- time, condition, event\n  config JSON,\n  enabled BOOLEAN,\n  last_fired TIMESTAMP\n);\n\nCREATE TABLE schedule_experiments (\n  id INTEGER PRIMARY KEY,\n  task TEXT,\n  time TEXT,\n  metric TEXT,\n  value REAL,\n  timestamp TIMESTAMP\n);\n```\n\n## BENEFITS\n\n1. **Full autonomy**: Kingston adapts schedule without Nicolas\n2. **Learning loop**: Discover optimal times through experiments\n3. **Rapid iteration**: Test new automations instantly\n4. **Safety**: Permission system prevents risky auto-changes\n5. **Visibility**: Dashboard shows all scheduled work\n\n## EXAMPLE USE CASE\n\nKingston notices Moltbook posts at 14h get low engagement.\n\n```typescript\n// Kingston autonomously runs:\nawait cron.adaptive({\n  current: \"0 14 * * *\",\n  goal: \"maximize_engagement\",\n  test_times: [\"10:00\", \"12:00\", \"16:00\", \"18:00\"]\n});\n\n// After 20 posts:\n// 10:00 ‚Üí avg 2.1 upvotes\n// 12:00 ‚Üí avg 3.8 upvotes ‚Üê WINNER\n// 14:00 ‚Üí avg 1.5 upvotes (current)\n// 16:00 ‚Üí avg 2.9 upvotes\n// 18:00 ‚Üí avg 2.3 upvotes\n\n// Kingston auto-updates cron to 12:00\n// Notifies Nicolas: \"üìä Optimized Moltbook posts to 12pm (2.5x engagement)\"\n```\n\nPRIORITY: HIGH - Unlocks true autonomy\n\nFILES: src/skills/builtin/cron.ts,src/skills/builtin/alarms.ts,src/scheduler/adaptive.ts,src/scheduler/templates.ts","priority":"high","files":"src/skills/builtin/cron.ts,src/skills/builtin/alarms.ts,src/scheduler/adaptive.ts,src/scheduler/templates.ts"}}